<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-menu-button></ion-menu-button>
    </ion-buttons>
    <ion-title>My Account</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content fullscreen>
  <form #updateForm="ngForm" (ngSubmit)="update(updateForm)">

    <ion-grid>

      <ion-row>
        <ion-col size="4">
          <div class="formQns">
            <ion-text>Name</ion-text>
          </div>
        </ion-col>
        <ion-col>
          <div class="formAns">
            <ion-input name="name" [(ngModel)]="name" [disabled]="isEditing" [readonly]=true>
            </ion-input>
          </div>
        </ion-col>
      </ion-row>

      <ion-row>
        <ion-col size="4">
          <div class="formQns">
            <ion-text>Password</ion-text>
          </div>
        </ion-col>
        <ion-col>
          <div>
            <ion-button id="changePasswordButton" [disabled]="isEditing" size="small" (click)="changePasswordPrompt()">
              Change Password
            </ion-button>
          </div>
        </ion-col>
      </ion-row>

      <ion-row *ngIf="passwordError">
        <ion-col size="4">
          <div>
            <ion-text></ion-text>
          </div>
        </ion-col>
        <ion-col>
          <div class="errorMessage">
            <ion-text>{{passwordErrorMessage}}</ion-text>
          </div>
        </ion-col>
      </ion-row>

      <ion-row>
        <ion-col size="4">
          <div class="formQns">
            <ion-text>Phone Number</ion-text>
          </div>
        </ion-col>
        <ion-col>
          <div class="formAns">
            <ion-input name="phoneNumber" [(ngModel)]="phoneNumber" type="tel" minlength="8" maxlength="8"
              pattern="^[89]\d{7}" [readonly]="!isEditing" (ngModelChange)="fieldChange()" required>
            </ion-input>
          </div>
        </ion-col>
      </ion-row>

      <ion-row *ngIf="phoneNumberError">
        <ion-col size="4">
          <div>
            <ion-text></ion-text>
          </div>
        </ion-col>
        <ion-col>
          <div class="errorMessage">
            <ion-text>{{phoneNumberErrorMessage}}</ion-text>
          </div>
        </ion-col>
      </ion-row>

      <ion-row>
        <ion-col size="4">
          <div class="formQns">
            <ion-text>ROD</ion-text>
          </div>
        </ion-col>
        <ion-col>
          <div class="formAns">
            <ion-input name="rod" value="{{rod | date:'dd/MM/yyyy'}}" [disabled]="isEditing" [readonly]="true">
            </ion-input>
          </div>
        </ion-col>
      </ion-row>

      <ion-row>
        <ion-col size="4">
          <div class="formQns">
            <ion-text>Email</ion-text>
          </div>
        </ion-col>
        <ion-col>
          <div class="formAns">
            <ion-input name="email" [(ngModel)]="email" type="email" minlength="9" maxlength="64" [disabled]="isEditing"
              [readonly]="true"></ion-input>
          </div>
        </ion-col>
      </ion-row>

      <ion-row>
        <ion-col size="4">
          <div class="formQns">
            <ion-text>Street Name*</ion-text>
          </div>
        </ion-col>
        <ion-col>
          <div class="formAns">
            <ion-textarea name="streetName" [(ngModel)]="streetName" type="text" minlength="6" [readonly]="!isEditing"
              (ngModelChange)="fieldChange()" required>
            </ion-textarea>
          </div>
        </ion-col>
      </ion-row>

      <ion-row *ngIf="streetNameError">
        <ion-col size="4">
          <div>
            <ion-text></ion-text>
          </div>
        </ion-col>
        <ion-col>
          <div class="errorMessage">
            <ion-text>{{streetNameErrorMessage}}</ion-text>
          </div>
        </ion-col>
      </ion-row>

      <ion-row>
        <ion-col size="4">
          <div class="formQns">
            <ion-text>Unit Number</ion-text>
          </div>
        </ion-col>
        <ion-col>
          <div class="formAns">
            <ion-input name="unitNumber" [(ngModel)]="unitNumber" type="text" [readonly]="!isEditing"
              (ngModelChange)="fieldChange()">
            </ion-input>
          </div>
        </ion-col>
      </ion-row>

      <ion-row>
        <ion-col size="4">
          <div class="formQns">
            <ion-text>Building Name</ion-text>
          </div>
        </ion-col>
        <ion-col>
          <div class="formAns">
            <ion-input name="buildingName" [(ngModel)]="buildingName" type="text" [readonly]="!isEditing"
              (ngModelChange)="fieldChange()">
            </ion-input>
          </div>
        </ion-col>
      </ion-row>

      <ion-row>
        <ion-col size="4">
          <div class="formQns">
            <ion-text>Postal*</ion-text>
          </div>
        </ion-col>
        <ion-col>
          <div class="formAns">
            <ion-input name="postal" [(ngModel)]="postal" type="number" pattern="^\d{6}" [readonly]="!isEditing"
              (ngModelChange)="fieldChange()" required>
            </ion-input>
          </div>
        </ion-col>
      </ion-row>

      <ion-row *ngIf="postalError">
        <ion-col size="4">
          <div>
            <ion-text></ion-text>
          </div>
        </ion-col>
        <ion-col>
          <div class="errorMessage">
            <ion-text>{{postalErrorMessage}}</ion-text>
          </div>
        </ion-col>
      </ion-row>

      <div id="successMessage" #successMessage>
        <ion-row *ngIf="updateSuccess">
          <ion-item class="successMessage">
            <ion-input style="color: #059731;" [readonly]=true>{{updateSuccessMessage}}</ion-input>
          </ion-item>
        </ion-row>
      </div>

    </ion-grid>

    <div *ngIf="!isEditing">
      <ion-button id="editDetailsButton" expand="block" (click)="editForm()">Edit Account Details</ion-button>
    </div>

    <div *ngIf="isEditing">

      <ion-row>

        <ion-button class="formButtons" (click)="editForm()" style="--background: #f8bd7f;">Cancel</ion-button>
        <ion-button class="formButtons" type="submit" [disabled]="updateForm.invalid || !fieldsUpdated"
          style="--background: #00416d;">
          Update</ion-button>

      </ion-row>

    </div>

  </form>
</ion-content>

<ion-footer *ngIf="!isEditing" class="ion-no-border">
  <ion-toolbar transparent no-border>
    <ion-button (click)="logout()" expand="block" style="--background: #f8bd7f">Logout</ion-button>
  </ion-toolbar>
</ion-footer>